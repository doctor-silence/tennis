# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `tennis_pro` –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ç–æ–ª—å–∫–æ 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. –¢—Ä–µ–Ω–µ—Ä –î–µ–º–æ (coach@test.com)
2. –°—É–ø–µ—Ä –ê–¥–º–∏–Ω (admin@tennis.pro)

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç–æ–º `initDb.js`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç **–±–∞–∑–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞**.

---

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **–°–ª—É—á–∞–π–Ω—ã–π –∑–∞–ø—É—Å–∫ `initDb.js` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ** - —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã –∑–∞–Ω–æ–≤–æ
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö** - –≤–æ–∑–º–æ–∂–Ω–æ, –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥–æ–π –ë–î
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π** - –¥–∞–Ω–Ω—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å —É—Ç–µ—Ä—è–Ω—ã
4. **DROP DATABASE –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –±—ç–∫–∞–ø–∞**

---

## üìã –ü–ª–∞–Ω –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd /var/www/tennispro/tennis/backend
cat .env
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `DB_NAME` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
cd /var/www/tennispro/tennis/backend
node checkProductionDb.js
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:
- –í—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –†–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–π –±–∞–∑—ã
- –¢–∞–±–ª–∏—Ü—ã –≤ —Ç–µ–∫—É—â–µ–π –ë–î
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –±–∞–∑—ã —Å –±–æ–ª—å—à–∏–º —Ä–∞–∑–º–µ—Ä–æ–º, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–∞–∑
sudo -u postgres psql -c "\l+"

# –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –±–∞–∑—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, tennis_backup), –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å:
PGPASSWORD='Vek19866891!' psql -U admin -d <–∏–º—è_–±–∞–∑—ã> -h localhost -c "SELECT COUNT(*) FROM users;"
```

### –®–∞–≥ 4: –ü–æ–∏—Å–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –±—ç–∫–∞–ø–æ–≤ PostgreSQL
ls -lh /var/lib/postgresql/backups/
ls -lh /var/backups/postgresql/
ls -lh ~/backups/

# –ü–æ–∏—Å–∫ dump —Ñ–∞–π–ª–æ–≤
find /var -name "*.dump" -o -name "*.sql" 2>/dev/null | grep -i tennis
```

---

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
PGPASSWORD='Vek19866891!' psql -U admin -d tennis_pro -h localhost < backup.sql

# –ò–ª–∏ –∏–∑ custom —Ñ–æ—Ä–º–∞—Ç–∞:
pg_restore -U admin -d tennis_pro backup.dump
```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥–æ–π –±–∞–∑–µ

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –¥–∞–º–ø –∏–∑ —Å—Ç–∞—Ä–æ–π –±–∞–∑—ã
pg_dump -U admin -h localhost —Å—Ç–∞—Ä–∞—è_–±–∞–∑–∞ > tennis_backup.sql

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ tennis_pro
PGPASSWORD='Vek19866891!' psql -U admin -d tennis_pro -h localhost < tennis_backup.sql

# 3. –û–±–Ω–æ–≤–∏—Ç–µ .env, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
nano /var/www/tennispro/tennis/backend/.env
# –ò–∑–º–µ–Ω–∏—Ç–µ DB_NAME –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

### –í–∞—Ä–∏–∞–Ω—Ç –í: –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É—Ç–µ—Ä—è–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø—Ä–∏–¥—ë—Ç—Å—è –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–Ω–æ–≤–æ. –î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã:**

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞
sudo nano /usr/local/bin/backup-tennis-db.sh
```

```bash
#!/bin/bash
BACKUP_DIR="/var/backups/tennis"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

pg_dump -U admin -h localhost tennis_pro > $BACKUP_DIR/tennis_pro_$DATE.sql
gzip $BACKUP_DIR/tennis_pro_$DATE.sql

# –£–¥–∞–ª–∏—Ç—å –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
find $BACKUP_DIR -name "*.sql.gz" -mtime +30 -delete

echo "Backup completed: tennis_pro_$DATE.sql.gz"
```

```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
sudo chmod +x /usr/local/bin/backup-tennis-db.sh

# –î–æ–±–∞–≤—å—Ç–µ –≤ cron (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3 —á–∞—Å–∞ –Ω–æ—á–∏)
sudo crontab -e
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
0 3 * * * /usr/local/bin/backup-tennis-db.sh >> /var/log/tennis-backup.log 2>&1
```

2. **–ó–∞—â–∏—Ç–∏—Ç–µ initDb.js –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**

–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –Ω–∞—á–∞–ª–æ `initDb.js`:

```javascript
if (process.env.NODE_ENV === 'production') {
  console.error('‚ùå –ó–ê–ü–†–ï–©–ï–ù–û: initDb.js –Ω–µ–ª—å–∑—è –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!');
  console.error('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–ª–∏ —Ä—É—á–Ω–æ–π SQL –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã.');
  process.exit(1);
}
```

---

## üîç –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
sudo -u postgres psql -c "SELECT datname, count(*) FROM pg_stat_activity GROUP BY datname;"

# 2. –†–∞–∑–º–µ—Ä –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql -c "SELECT datname, pg_size_pretty(pg_database_size(datname)) FROM pg_database ORDER BY pg_database_size(datname) DESC;"

# 3. –ö–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –∏–∑–º–µ–Ω—è–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ –≤ users
PGPASSWORD='Vek19866891!' psql -U admin -d tennis_pro -h localhost -c "SELECT MAX(created_at) FROM users;"

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgreSQL
sudo tail -100 /var/log/postgresql/postgresql-*.log | grep -i "tennis_pro\|DROP\|CREATE DATABASE"

# 5. –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥ bash (–º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å)
history | grep -i "initDb\|psql\|pg_dump"
```

---

## üìù –î–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `checkProductionDb.js` –≤–µ—Ä–Ω–∏—Ç–µ—Å—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏, –∏ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏!
