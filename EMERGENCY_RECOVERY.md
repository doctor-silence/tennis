# üÜò –°–†–û–ß–ù–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## –°–∏—Ç—É–∞—Ü–∏—è
–ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–µ –≤ –±–∞–∑–µ `tennis_pro` –≤—Å–µ–≥–æ **2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (admin –∏ coach demo).
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –±–∞–∑–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å–∫—Ä–∏–ø—Ç–æ–º `initDb.js`.

---

## ‚ö° –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

### 1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh tennis@sixoreuntp
cd /var/www/tennispro/tennis/backend
```

### 2Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –í–°–ï –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –Ω–∞–π–¥—ë—Ç —Ç—É, –≥–¥–µ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
source .env

# –ò–ª–∏ —è–≤–Ω–æ —É–∫–∞–∂–∏—Ç–µ:
export DB_USER=admin
export DB_HOST=localhost
export DB_NAME=tennis_pro
export DB_PASSWORD=Vek19866891!
export DB_PORT=5432

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
node scanAllDatabases.js
```

**–ß—Ç–æ –æ–Ω —Å–¥–µ–ª–∞–µ—Ç:**
- –ù–∞–π–¥—ë—Ç –≤—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –∫–∞–∂–¥—É—é –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã `users`
- –ü–æ–∫–∞–∂–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞–∂–¥–æ–π –±–∞–∑–µ
- –í—ã–≤–µ–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ 2

### 3Ô∏è‚É£ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (—á–µ—Ä–µ–∑ PostgreSQL –Ω–∞–ø—Ä—è–º—É—é)

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–∞–∑ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏
sudo -u postgres psql -c "\l+"

# –ï—Å–ª–∏ —É–≤–∏–¥–µ–ª–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –±–∞–∑—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, tennis_backup, tennis_old), –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
PGPASSWORD='Vek19866891!' psql -U admin -d –∏–º—è_–±–∞–∑—ã -h localhost -c "SELECT COUNT(*) FROM users;"
```

---

## üéØ –°–¶–ï–ù–ê–†–ò–ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π –ê: –ù–∞–π–¥–µ–Ω–∞ –±–∞–∑–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

–ï—Å–ª–∏ `scanAllDatabases.js` –Ω–∞—à—ë–ª –±–∞–∑—É —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ù–ê–ô–î–ï–ù–ù–û–ô –±–∞–∑—ã
pg_dump -U admin -h localhost -d –Ω–∞–π–¥–µ–Ω–Ω–∞—è_–±–∞–∑–∞ > tennis_backup_$(date +%Y%m%d_%H%M%S).sql

# 2. –í–ê–ñ–ù–û: –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–π tennis_pro (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
pg_dump -U admin -h localhost -d tennis_pro > tennis_pro_before_restore_$(date +%Y%m%d_%H%M%S).sql

# 3. –í–∞—Ä–∏–∞–Ω—Ç A: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ .env –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—É—é –±–∞–∑—É
nano .env
# –ò–∑–º–µ–Ω–∏—Ç–µ: DB_NAME=–Ω–∞–π–¥–µ–Ω–Ω–∞—è_–±–∞–∑–∞

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pm2 restart all

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
curl http://localhost:3001/api/health
```

**–ò–õ–ò**

```bash
# 3. –í–∞—Ä–∏–∞–Ω—Ç –ë: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ tennis_pro
PGPASSWORD='Vek19866891!' psql -U admin -d tennis_pro -h localhost < tennis_backup_*.sql

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pm2 restart all
```

### –°—Ü–µ–Ω–∞—Ä–∏–π –ë: –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –Ω–æ –µ—Å—Ç—å —Ñ–∞–π–ª—ã —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

```bash
# –ü–æ–∏—Å–∫ dump —Ñ–∞–π–ª–æ–≤
find /var/lib/postgresql /var/backups /home -name "*.sql" -o -name "*.dump" 2>/dev/null | grep -i tennis

# –ï—Å–ª–∏ –Ω–∞—à–ª–∏, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
PGPASSWORD='Vek19866891!' psql -U admin -d tennis_pro -h localhost < –Ω–∞–π–¥–µ–Ω–Ω—ã–π_backup.sql
```

### –°—Ü–µ–Ω–∞—Ä–∏–π –í: –î–∞–Ω–Ω—ã–µ —É—Ç–µ—Ä—è–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ üòû

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø—Ä–∏–¥—ë—Ç—Å—è –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ. –ù–æ —Å—Ä–∞–∑—É –Ω–∞—Å—Ç—Ä–æ–∏–º –∞–≤—Ç–æ–±—ç–∫–∞–ø:

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–æ–≤
sudo mkdir -p /var/backups/tennis
sudo chown tennis:tennis /var/backups/tennis

# 2. –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–±—ç–∫–∞–ø–∞
sudo nano /usr/local/bin/backup-tennis.sh
```

–í—Å—Ç–∞–≤—å—Ç–µ:

```bash
#!/bin/bash
BACKUP_DIR="/var/backups/tennis"
DATE=$(date +%Y%m%d_%H%M%S)
KEEP_DAYS=30

# –°–æ–∑–¥–∞—ë–º –±—ç–∫–∞–ø
pg_dump -U admin -h localhost tennis_pro | gzip > $BACKUP_DIR/tennis_pro_$DATE.sql.gz

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã
find $BACKUP_DIR -name "*.sql.gz" -mtime +$KEEP_DAYS -delete

echo "‚úÖ Backup created: tennis_pro_$DATE.sql.gz"
```

```bash
# 3. –°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
sudo chmod +x /usr/local/bin/backup-tennis.sh

# 4. –î–æ–±–∞–≤—å—Ç–µ –≤ cron (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
crontab -e
# –î–æ–±–∞–≤—å—Ç–µ:
0 3 * * * /usr/local/bin/backup-tennis.sh >> /var/log/tennis-backup.log 2>&1

# 5. –ü–µ—Ä–≤—ã–π –±—ç–∫–∞–ø –≤—Ä—É—á–Ω—É—é
/usr/local/bin/backup-tennis.sh
```

---

## üîí –ó–ê–©–ò–¢–ê –û–¢ –ü–û–í–¢–û–†–ï–ù–ò–Ø

–Ø —É–∂–µ –¥–æ–±–∞–≤–∏–ª –∑–∞—â–∏—Ç—É –≤ `initDb.js`. –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /var/www/tennispro/tennis/backend

# –°–∫–∞—á–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π initDb.js –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git pull origin main

# –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é –∑–∞—â–∏—â—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å `node initDb.js` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: initDb.js –∑–∞–ø—Ä–µ—â—ë–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì

–ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
PGPASSWORD='Vek19866891!' psql -U admin -d tennis_pro -h localhost -c "SELECT COUNT(*) FROM users;"

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
PGPASSWORD='Vek19866891!' psql -U admin -d tennis_pro -h localhost -c "SELECT id, name, email, created_at FROM users ORDER BY created_at DESC LIMIT 10;"

# –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã
node checkProductionDb.js
```

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

–°–≤—è–∂–∏—Ç–µ—Å—å —Å–æ –º–Ω–æ–π –∏ –ø–æ–∫–∞–∂–∏—Ç–µ –≤—ã–≤–æ–¥:

```bash
node scanAllDatabases.js > scan_result.txt 2>&1
cat scan_result.txt
```

–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–∞–Ω–¥—ã:

```bash
sudo -u postgres psql -c "\l+" | grep tennis
```

---

## üìù –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –ó–∞–ø—É—â–µ–Ω `scanAllDatabases.js`
- [ ] –ù–∞–π–¥–µ–Ω–∞ –±–∞–∑–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –∏–∑–º–µ–Ω—ë–Ω DB_NAME
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä (pm2 restart all)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω initDb.js —Å –∑–∞—â–∏—Ç–æ–π

**–£–¥–∞—á–∏! üçÄ**
